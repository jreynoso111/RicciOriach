<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evento | Riccie Oriach</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root { --color-bg:#300505; --color-text:#F4F4F4; --color-accent:#FF5E6C; --color-secondary:#FFD700; --card:rgba(255,255,255,0.06); }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Outfit',sans-serif;background:radial-gradient(circle at 50% 50%,#3a0a0a 0%,#180303 100%);color:var(--color-text);min-height:100vh;overflow-x:hidden;position:relative;}
    body::before{content:"";position:fixed;inset:0;background-image:url('assets/texture.png');background-size:cover;opacity:0.22;z-index:-2;pointer-events:none;}
    body::after{content:"";position:fixed;inset:0;background:linear-gradient(45deg,rgba(255,94,108,0.12),transparent);z-index:-1;pointer-events:none;}
    #canvas-bg{position:fixed;inset:0;width:100%;height:100%;z-index:-1;pointer-events:none;}
    .navbar{display:flex;align-items:center;padding:1.25rem 2rem;position:absolute;top:0;left:0;width:100%;z-index:10;}
    .logo a{font-family:'Abril Fatface',cursive;font-size:1.5rem;color:var(--color-secondary);text-decoration:none;letter-spacing:1px;}
    .nav-links{list-style:none;display:flex;gap:1.5rem;margin-left:auto;}
    .nav-links a{color:var(--color-text);text-decoration:none;font-weight:600;letter-spacing:0.5px;}
    .nav-links a.active{color:var(--color-accent);}
    .hero{padding:7rem 2rem 3rem;max-width:1050px;margin:0 auto;display:grid;gap:0.5rem;}
    .hero h1{font-size:3rem;}
    .hero p{color:rgba(244,244,244,0.8);}
    .layout{max-width:1050px;margin:0 auto;padding:0 2rem 4rem;display:grid;gap:1.2rem;}
    .card{background:var(--card);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:1.2rem;box-shadow:0 12px 30px rgba(0,0,0,0.26);}
    .meta{display:flex;gap:1rem;flex-wrap:wrap;color:rgba(244,244,244,0.76);}
    .actions{display:flex;gap:0.6rem;flex-wrap:wrap;margin-top:0.75rem;}
    .btn{display:inline-flex;align-items:center;gap:0.35rem;padding:0.65rem 0.95rem;border-radius:10px;border:1px solid var(--color-accent);color:var(--color-text);background:rgba(255,94,108,0.15);text-decoration:none;font-weight:700;cursor:pointer;}
    .btn.secondary{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.2);}
    .admin-inline{margin-top:0.5rem;border:1px dashed rgba(255,255,255,0.3);padding:0.65rem;border-radius:12px;background:rgba(0,0,0,0.25);}
    .admin-inline summary{cursor:pointer;color:var(--color-secondary);font-weight:700;}
    .admin-inline form{display:grid;gap:0.35rem;}
    .admin-inline label{display:flex;flex-direction:column;gap:0.2rem;}
    .admin-inline input,.admin-inline select,.admin-inline textarea{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.14);color:var(--color-text);padding:0.45rem 0.6rem;border-radius:10px;}
  </style>
</head>
<body>
  <canvas id="canvas-bg"></canvas>
  <nav class="navbar">
    <div class="logo"><a href="index.html">RICCIE ORIACH</a></div>
    <ul class="nav-links">
      <li><a href="index.html">INICIO</a></li>
      <li><a href="music.html">M√öSICA</a></li>
      <li><a href="merch.html">MERCH</a></li>
      <li><a class="active" href="events.html">TICKETS</a></li>
      <li><a href="blog.html">BLOG</a></li>
      <li><a href="contact.html">CONTACTO</a></li>
      <li><a href="perfil.html">PERFIL</a></li>
      <li><a href="auth/login.html">ACCESO</a></li>
    </ul>
  </nav>

  <section class="hero">
    <div id="event-pill" class="meta"></div>
    <h1 id="event-title">Evento</h1>
    <p id="event-desc">Cargando detalles del show.</p>
    <div class="actions">
      <button class="btn" id="add-ticket">Agregar ticket</button>
      <a class="btn secondary" href="ticket-checkout.html">Ir al checkout</a>
      <a class="btn secondary" href="events.html">Volver a tickets</a>
    </div>
  </section>

  <section class="layout">
    <div class="card">
      <h3>Informaci√≥n</h3>
      <div class="meta" id="event-meta"></div>
      <div class="admin-inline" id="admin-slot" style="display:none;"></div>
    </div>
    <div class="card">
      <h3>Notas</h3>
      <p id="event-notes">Confirma tu sesi√≥n para guardar los pases en tu perfil.</p>
    </div>
  </section>

  <script src="auth/auth.js"></script>
  <script>
    const EVENTS_KEY = 'ricciEvents';
    const TICKET_CART_KEY = 'ricciTicketCart';
    const session = window.RicciAuth?.getSession?.();
    const isManager = ['admin','manager'].includes(session?.role);
    const defaultEvents = [
      { slug:'gira-santo-domingo', title:'Gira Santo Domingo', date:'2025-04-12', city:'Santo Domingo', venue:'Teatro Nacional', price:45, capacity:350, status:'Activo', description:'Show extendido con banda completa y visuales caribe futuristas.' }
    ];
    const slugify = (text='') => text.toString().toLowerCase().trim().replace(/[^a-z0-9√±√°√©√≠√≥√∫√º\s-]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-');
    const loadEvents = () => (JSON.parse(localStorage.getItem(EVENTS_KEY)) || defaultEvents).map(ev => ({ ...ev, slug: ev.slug || slugify(ev.title) }));

    const params = new URLSearchParams(window.location.search);
    const slug = params.get('slug');
    let event = loadEvents().find(ev => ev.slug === slug) || defaultEvents[0];

    function addTicket(){
      const cart = JSON.parse(localStorage.getItem(TICKET_CART_KEY) || '[]');
      const existing = cart.find(item => item.slug === event.slug);
      if (existing) existing.qty += 1; else cart.push({ slug: event.slug, qty:1 });
      localStorage.setItem(TICKET_CART_KEY, JSON.stringify(cart));
      alert('Ticket a√±adido al checkout.');
    }

    function renderEvent(){
      document.getElementById('event-title').textContent = event.title;
      document.getElementById('event-desc').textContent = event.description || '';
      document.getElementById('event-meta').innerHTML = `
        <span>üìç ${event.city || ''} ¬∑ ${event.venue || 'Lugar por anunciar'}</span>
        <span>üìÖ ${event.date || 'Pr√≥ximamente'}</span>
        <span>üíµ $${Number(event.price||0).toFixed(2)} USD</span>
        <span>üéüÔ∏è ${event.capacity || 'Cupo abierto'}</span>
      `;
      document.getElementById('event-pill').innerHTML = `<span class="btn secondary">${event.status || 'Activo'}</span>`;
      document.getElementById('add-ticket').disabled = event.status === 'Borrador';
      if (isManager) renderAdmin();
    }

    function renderAdmin(){
      const slot = document.getElementById('admin-slot');
      slot.style.display = 'block';
      slot.innerHTML = `
        <details open>
          <summary>Editar evento</summary>
          <form id="admin-form">
            <label>T√≠tulo<input name="title" value="${event.title}"></label>
            <label>Slug<input name="slug" value="${event.slug}"></label>
            <label>Fecha<input type="date" name="date" value="${event.date || ''}"></label>
            <label>Ciudad<input name="city" value="${event.city || ''}"></label>
            <label>Venue<input name="venue" value="${event.venue || ''}"></label>
            <label>Precio<input type="number" step="0.01" name="price" value="${event.price || 0}"></label>
            <label>Cupo<input type="number" name="capacity" value="${event.capacity || 0}"></label>
            <label>Estado<select name="status">
              <option value="Activo" ${event.status==='Activo'?'selected':''}>Activo</option>
              <option value="Borrador" ${event.status==='Borrador'?'selected':''}>Borrador</option>
            </select></label>
            <label>Descripci√≥n<textarea name="description">${event.description || ''}</textarea></label>
            <button class="btn" type="submit">Guardar</button>
          </form>
        </details>`;
      document.getElementById('admin-form').addEventListener('submit',(e)=>{
        e.preventDefault();
        const data = new FormData(e.target);
        const updates = Object.fromEntries(data.entries());
        const events = loadEvents().map(ev => ev.slug === event.slug ? {
          ...ev,
          ...updates,
          price: Number(updates.price)||0,
          capacity: Number(updates.capacity)||0,
          slug: updates.slug || slugify(updates.title)
        } : ev);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        event = events.find(ev => ev.slug === (updates.slug || slug)) || event;
        renderEvent();
      });
    }

    document.getElementById('add-ticket').addEventListener('click', addTicket);
    renderEvent();
  </script>
  <script>
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particlesArray = []; let speedMultiplier = 1; let scrollTimeout; const hues=[90,110,135,155,180,210];
    class Particle{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.size=Math.random()*3+0.5;const depth=this.size*0.18;this.speedX=(Math.random()*2-1)*depth;this.speedY=(Math.random()*2-1)*depth;const hue=hues[Math.floor(Math.random()*hues.length)];const light=45+Math.random()*35;const alpha=0.18+Math.random()*0.32;this.color=`hsla(${hue},70%,${light}%,${alpha})`;}
      update(){this.x+=this.speedX*speedMultiplier;this.y+=this.speedY*speedMultiplier;if(this.x>canvas.width)this.x=0;else if(this.x<0)this.x=canvas.width;if(this.y>canvas.height)this.y=0;else if(this.y<0)this.y=canvas.height;}
      draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=this.color;ctx.fill();}}
    function init(){particlesArray=[];const count=(canvas.width*canvas.height)/9000;for(let i=0;i<count;i++)particlesArray.push(new Particle());}
    function animate(){requestAnimationFrame(animate);ctx.clearRect(0,0,canvas.width,canvas.height);particlesArray.forEach(p=>{p.update();p.draw();});}
    window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;init();});
    window.addEventListener('wheel',()=>{speedMultiplier=3;clearTimeout(scrollTimeout);scrollTimeout=setTimeout(()=>speedMultiplier=1,250);});
    init();animate();
  </script>
</body>
</html>
