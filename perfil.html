<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de perfil | Riccie Oriach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --color-bg:#300505; --color-text:#F4F4F4; --color-accent:#FF5E6C; --color-secondary:#FFD700; --color-outline:rgba(255,94,108,0.7); --card:rgba(255,255,255,0.06);}
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:'Outfit',sans-serif;background:radial-gradient(circle at 50% 50%,#3a0a0a 0%,#180303 100%);color:var(--color-text);min-height:100vh;overflow-x:hidden;position:relative;}
        body::before{content:"";position:fixed;inset:0;background-image:url('assets/texture.png');background-size:cover;opacity:0.22;z-index:-2;pointer-events:none;}
        body::after{content:"";position:fixed;inset:0;background:linear-gradient(45deg,rgba(255,94,108,0.12),transparent);z-index:-1;pointer-events:none;}
        #canvas-bg{position:fixed;inset:0;width:100%;height:100%;z-index:-1;pointer-events:none;}
        .navbar{display:flex;align-items:center;padding:1.25rem 2rem;position:absolute;top:0;left:0;width:100%;z-index:10;}
        .logo a{font-family:'Abril Fatface',cursive;font-size:1.4rem;color:var(--color-secondary);text-decoration:none;letter-spacing:1px;}
        .nav-links{list-style:none;display:flex;gap:1.75rem;margin-left:auto;}
        .nav-links a{color:var(--color-text);text-decoration:none;font-weight:600;letter-spacing:0.5px;}
        .nav-links a.active{color:var(--color-accent);}
        .hero{padding:8rem 2rem 3rem;max-width:1100px;margin:0 auto;}
        .hero h1{font-size:2.5rem;letter-spacing:1px;margin-bottom:0.5rem;}
        .hero p{color:rgba(244,244,244,0.75);}
        .page{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1rem;margin:0 auto 2rem;max-width:1150px;padding:0 2rem;}
        .card{background:var(--card);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:1.1rem;box-shadow:0 12px 30px rgba(0,0,0,0.28);}
        .card h3{margin-bottom:0.35rem;}
        .badge{display:inline-flex;align-items:center;gap:0.35rem;font-weight:700;font-size:0.8rem;padding:0.25rem 0.75rem;border-radius:999px;background:rgba(255,94,108,0.2);color:var(--color-accent);}
        label{display:flex;flex-direction:column;gap:0.25rem;font-weight:600;font-size:0.95rem;}
        input,textarea,select{width:100%;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.12);color:var(--color-text);padding:0.65rem 0.75rem;border-radius:10px;font-size:1rem;}
        textarea{min-height:110px;resize:vertical;}
        .actions{display:flex;flex-wrap:wrap;gap:0.75rem;margin-top:0.75rem;}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:0.35rem;padding:0.75rem 1rem;border-radius:12px;border:1px solid var(--color-outline);background:linear-gradient(120deg,rgba(255,94,108,0.18),rgba(255,94,108,0.08));color:var(--color-text);font-weight:700;text-decoration:none;cursor:pointer;}
        .btn.secondary{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.2);}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:0.75rem;}
        .muted{color:rgba(244,244,244,0.7);margin-top:0.35rem;}
        .status{font-weight:700;color:var(--color-secondary);}
        .list{display:grid;gap:0.65rem;}
    </style>
</head>
<body>
    <canvas id="canvas-bg"></canvas>
    <nav class="navbar">
        <div class="logo"><a href="index.html">RICCIE ORIACH</a></div>
        <ul class="nav-links">
            <li><a href="index.html">INICIO</a></li>
            <li><a href="music.html">MÚSICA</a></li>
            <li><a href="merch.html">MERCH</a></li>
            <li><a href="events.html">TICKETS</a></li>
            <li><a href="blog.html">BLOG</a></li>
            <li><a href="contact.html">CONTACTO</a></li>
            <li><a class="active" href="perfil.html">PERFIL</a></li>
            <li><a href="checkout.html">CHECKOUT</a></li>
            <li><a href="ordenes.html">ÓRDENES</a></li>
            <li><a href="auth/login.html">ACCESO</a></li>
        </ul>
    </nav>

    <section class="hero">
        <p>CUENTA · SEGURIDAD</p>
        <h1>Registra tu perfil seguro</h1>
        <p>Si no tienes cuenta, aquí creas tu perfil y tus credenciales. Si ya estás registrado, ingresa con usuario y contraseña y seguimos con tus datos guardados.</p>
    </section>

    <section class="page">
        <div class="card" id="registro">
            <p class="badge">Registro único</p>
            <h3>Crear perfil y cuenta</h3>
            <p class="muted">Un solo formulario para credenciales y datos de checkout. Guardamos la información en la base local cifrada para desarrollo.</p>
            <form id="profile-register-form" class="form-grid">
                <label>Nombre completo<input id="full-name" required></label>
                <label>Correo electrónico<input type="email" id="reg-email" required></label>
                <label>Contraseña segura<input type="password" id="reg-password" required></label>
                <label>Teléfono<input type="tel" id="reg-phone" placeholder="WhatsApp para seguimiento"></label>
                <label>Documento / ID<input id="reg-doc"></label>
                <label>Dirección<input id="reg-address" placeholder="Calle, número, referencias" required></label>
                <label>Ciudad<input id="reg-city" required></label>
                <label>País<input id="reg-country" value="República Dominicana" required></label>
                <label>Método de envío preferido
                    <select id="reg-shipping">
                        <option value="pickup">Recogida en evento / pickup</option>
                        <option value="domicilio">Entrega a domicilio</option>
                    </select>
                </label>
                <label>Preferencia de pago
                    <select id="reg-payment">
                        <option value="card">Tarjeta (Stripe/CardNet/Azul)</option>
                        <option value="transfer">Transferencia / Zelle</option>
                        <option value="cash">Pago contra entrega</option>
                    </select>
                </label>
                <label>Notas adicionales<textarea id="reg-notes" placeholder="Instrucciones de entrega o tallas"></textarea></label>
                <div class="actions">
                    <button class="btn" type="submit">Guardar perfil</button>
                    <a class="btn secondary" href="auth/login.html">Ya tengo cuenta</a>
                </div>
            </form>
            <p class="muted" id="form-hint">No hay sesión activa. Completa el registro para habilitar tu perfil.</p>
        </div>
        <div class="card">
            <p class="badge">Acceso rápido</p>
            <h3>Iniciar sesión</h3>
            <p class="muted">Ingresa tus credenciales. Si no encontramos la cuenta te llevamos directo al registro.</p>
            <form id="inline-login" class="list">
                <label>Correo electrónico<input type="email" id="login-email" required></label>
                <label>Contraseña<input type="password" id="login-password" required></label>
                <div class="actions">
                    <button class="btn" type="submit">Ingresar</button>
                    <a class="btn secondary" href="auth/register.html">Ir al registro</a>
                </div>
            </form>
            <p class="status" id="session-state">Sin sesión activa.</p>
        </div>
    </section>

    <section class="page">
        <div class="card">
            <p class="badge">Perfiles registrados (dev)</p>
            <h3>Base de datos local</h3>
            <p class="muted">Mostramos un resumen en memoria para validar la estructura de seguridad y roles antes de pasar a backend real.</p>
            <div id="registered-profiles" class="list"></div>
        </div>
    </section>

    <script src="auth/auth.js"></script>
    <script>
        const registerForm = document.getElementById('profile-register-form');
        const loginForm = document.getElementById('inline-login');
        const sessionState = document.getElementById('session-state');
        const formHint = document.getElementById('form-hint');
        const profilesContainer = document.getElementById('registered-profiles');

        function fillFormFromProfile(profile) {
            if (!profile) return;
            document.getElementById('full-name').value = profile.name || '';
            document.getElementById('reg-email').value = profile.email || document.getElementById('reg-email').value;
            document.getElementById('reg-phone').value = profile.phone || '';
            document.getElementById('reg-doc').value = profile.document || '';
            document.getElementById('reg-address').value = profile.address || '';
            document.getElementById('reg-city').value = profile.city || '';
            document.getElementById('reg-country').value = profile.country || document.getElementById('reg-country').value;
            if (profile.shipping) document.getElementById('reg-shipping').value = profile.shipping;
            if (profile.payment) document.getElementById('reg-payment').value = profile.payment;
            document.getElementById('reg-notes').value = profile.notes || '';
        }

        function refreshProfilesList() {
            const profiles = RicciAuth.loadProfiles();
            profilesContainer.innerHTML = '';
            const emails = Object.keys(profiles || {});
            if (!emails.length) {
                profilesContainer.innerHTML = '<p class="muted">Sin perfiles registrados aún.</p>';
                return;
            }
            emails.forEach(email => {
                const card = document.createElement('div');
                card.className = 'card';
                const record = profiles[email];
                card.innerHTML = `<strong>${email}</strong><p class="muted">Creado: ${new Date(record.createdAt || '').toLocaleString()} · Actualizado: ${new Date(record.updatedAt || '').toLocaleString()}</p>`;
                profilesContainer.appendChild(card);
            });
        }

        function syncSession() {
            const session = RicciAuth.getSession();
            if (session?.email) {
                sessionState.textContent = `Sesión activa: ${session.email}`;
                formHint.textContent = 'Sesión activa, puedes actualizar tu perfil o continuar al checkout.';
                fillFormFromProfile({ email: session.email, ...RicciAuth.getProfileForUser(session.email), name: session.name });
            } else {
                sessionState.textContent = 'Sin sesión activa.';
                formHint.textContent = 'No hay sesión activa. Completa el registro para habilitar tu perfil.';
            }
            refreshProfilesList();
        }

        registerForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const payload = {
                name: document.getElementById('full-name').value.trim(),
                email: document.getElementById('reg-email').value.trim(),
                password: document.getElementById('reg-password').value.trim(),
                phone: document.getElementById('reg-phone').value.trim(),
                document: document.getElementById('reg-doc').value.trim(),
                address: document.getElementById('reg-address').value.trim(),
                city: document.getElementById('reg-city').value.trim(),
                country: document.getElementById('reg-country').value.trim(),
                shipping: document.getElementById('reg-shipping').value,
                payment: document.getElementById('reg-payment').value,
                notes: document.getElementById('reg-notes').value.trim()
            };
            try {
                const existing = RicciAuth.loadUsers().find(u => u.email.toLowerCase() === payload.email.toLowerCase());
                if (!existing) {
                    RicciAuth.registerUser({ name: payload.name, email: payload.email, password: payload.password, provider: 'password', role: 'user' });
                } else {
                    RicciAuth.loginUser(payload.email, payload.password);
                }
                RicciAuth.saveProfileForUser(payload.email, payload);
                alert('Perfil guardado. Sesión activa y datos listos para checkout.');
                syncSession();
            } catch (err) {
                alert(err.message || 'No se pudo guardar el perfil.');
            }
        });

        loginForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            try {
                RicciAuth.loginUser(email, password);
                formHint.textContent = 'Sesión activa, puedes actualizar tu perfil o ir al checkout.';
                syncSession();
            } catch (err) {
                const message = err.message || 'No se pudo iniciar sesión.';
                alert(message);
                if (/no encontramos esa cuenta/i.test(message)) {
                    window.location.hash = '#registro';
                }
            }
        });

        syncSession();
    </script>
    <script>
        const canvas = document.getElementById('canvas-bg');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particlesArray = []; let speedMultiplier = 1; let scrollTimeout; const hues=[90,110,135,155,180,210];
        class Particle{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.size=Math.random()*3+0.5;this.speedX=(Math.random()*2-1)*this.size*0.18;this.speedY=(Math.random()*2-1)*this.size*0.18;const hue=hues[Math.floor(Math.random()*hues.length)];const light=45+Math.random()*35;const alpha=0.18+Math.random()*0.32;this.color=`hsla(${hue},70%,${light}%,${alpha})`;}
            update(){this.x+=this.speedX*speedMultiplier;this.y+=this.speedY*speedMultiplier;if(this.x>canvas.width)this.x=0;else if(this.x<0)this.x=canvas.width;if(this.y>canvas.height)this.y=0;else if(this.y<0)this.y=canvas.height;}
            draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=this.color;ctx.fill();}}
        function init(){particlesArray=[];const count=(canvas.width*canvas.height)/9000;for(let i=0;i<count;i++)particlesArray.push(new Particle());}
        function animate(){requestAnimationFrame(animate);ctx.clearRect(0,0,canvas.width,canvas.height);particlesArray.forEach(p=>{p.update();p.draw();});}
        window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;init();});
        window.addEventListener('wheel',()=>{speedMultiplier=3;clearTimeout(scrollTimeout);scrollTimeout=setTimeout(()=>speedMultiplier=1,250);});
        init(); animate();
    </script>
</body>
</html>
